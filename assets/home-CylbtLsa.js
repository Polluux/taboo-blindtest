import{d as w,u as g,r as f,o as k,c as n,a as u,b as t,t as c,e as x,w as C,f as p,F as S,g as V,h as U,i as _,v,j as B,k as a}from"./index-BsXQhAVk.js";const F={class:"flex h-full flex-col items-center justify-center gap-2"},L={key:0,class:"flex items-center gap-2"},M={key:1,class:"flex items-center gap-2"},N=t("div",null,"User not logged",-1),j=t("span",null,"login",-1),D=t("th",{class:"border p-4"},"id",-1),I=t("th",{class:"border p-4"},"reference",-1),q=t("th",{class:"border p-4"},"title",-1),A=t("th",{class:"border p-4"},"artist",-1),E=t("th",{class:"border p-4"},"words",-1),G={key:0,class:"border p-4"},R={class:"border p-4"},T={class:"border p-4"},$={class:"border p-4"},z={class:"border p-4"},H={class:"border p-4"},J={key:0,class:"border p-4"},K=["onClick"],O=t("button",{type:"submit",class:"btn"},"Add",-1),P={key:3,class:"relative rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert"},Y=w({__name:"home",setup(Q){const l=g(),h=f([]),d=f(""),o=f({reference:"",title:"",artist:"",words:""});k(async()=>{b()});async function b(){var i;d.value="";try{const{data:e}=await((i=l.supabaseClient)==null?void 0:i.from("musics").select());h.value=e??[]}catch(e){console.error(e),d.value=e}}async function m(i){var e;d.value="";try{const r=await((e=l.supabaseClient)==null?void 0:e.from("musics").delete().eq("id",i.id));if(r!=null&&r.error)throw r==null?void 0:r.error;b()}catch(r){console.error(r),d.value=r}}async function y(){var i;if(o.value.reference&&o.value.title&&o.value.artist&&o.value.words){d.value="";try{const e=await((i=l.supabaseClient)==null?void 0:i.from("musics").insert({...o.value,words:o.value.words.split(", ")}));if(e!=null&&e.error)throw e==null?void 0:e.error;b(),o.value={reference:"",title:"",artist:"",words:""}}catch(e){console.error(e),d.value=e}}}return(i,e)=>{const r=B("router-link");return a(),n("div",F,[u(l).userSession?(a(),n("div",L,[t("div",null,"Logged as : "+c(u(l).userSession.user.email),1),t("button",{class:"btn",type:"button",onClick:e[0]||(e[0]=(...s)=>u(l).logout&&u(l).logout(...s))}," Logout ")])):(a(),n("div",M,[N,x(r,{"aria-label":"back",class:"btn",to:{name:"login"},type:"button"},{default:C(()=>[j]),_:1})])),t("table",null,[t("thead",null,[t("tr",null,[D,I,q,A,E,u(l).userSession?(a(),n("th",G)):p("",!0)])]),t("tbody",null,[(a(!0),n(S,null,V(h.value,s=>(a(),n("tr",null,[t("td",R,c(s.id),1),t("td",T,c(s.reference),1),t("td",$,c(s.title),1),t("td",z,c(s.artist),1),t("td",H,c(s.words),1),u(l).userSession?(a(),n("td",J,[t("button",{class:"btn",onClick:W=>m(s)},"Remove",8,K)])):p("",!0)]))),256))])]),u(l).userSession?(a(),n("form",{key:2,onSubmit:U(y,["prevent"]),class:"flex gap-2"},[_(t("input",{type:"text",placeholder:"reference","onUpdate:modelValue":e[1]||(e[1]=s=>o.value.reference=s)},null,512),[[v,o.value.reference]]),_(t("input",{type:"text",placeholder:"title","onUpdate:modelValue":e[2]||(e[2]=s=>o.value.title=s)},null,512),[[v,o.value.title]]),_(t("input",{type:"text",placeholder:"artist","onUpdate:modelValue":e[3]||(e[3]=s=>o.value.artist=s)},null,512),[[v,o.value.artist]]),_(t("input",{type:"text",placeholder:"words, words","onUpdate:modelValue":e[4]||(e[4]=s=>o.value.words=s)},null,512),[[v,o.value.words]]),O],32)):p("",!0),d.value?(a(),n("div",P,c(d.value),1)):p("",!0)])}}});export{Y as default};
