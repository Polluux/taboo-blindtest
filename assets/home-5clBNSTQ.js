import{d as x,u as C,r as m,o as S,c as n,a as u,b as t,t as c,e as V,w as A,f as p,F as U,g as B,h as F,i as _,v,j as L,k as a}from"./index-CjiGmndg.js";const M={class:"flex h-full flex-col items-center justify-center gap-2"},N={key:0,class:"flex items-center gap-2"},j={key:1,class:"flex items-center gap-2"},D=t("div",null,"User not logged",-1),I=t("span",null,"login",-1),q=t("th",{class:"border p-4"},"id",-1),E=t("th",{class:"border p-4"},"reference",-1),G=t("th",{class:"border p-4"},"title",-1),R=t("th",{class:"border p-4"},"artist",-1),T=t("th",{class:"border p-4"},"words",-1),$={key:0,class:"border p-4"},z={class:"border p-4"},H={class:"border p-4"},J={class:"border p-4"},K={class:"border p-4"},O={class:"border p-4"},P={key:0,class:"border p-4"},Q=["onClick"],W=t("button",{type:"submit",class:"btn"},"Add",-1),X={key:3,class:"relative rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert"},te=x({__name:"home",setup(Y){const r=C(),f=m([]),i=m(""),o=m({reference:"",title:"",artist:"",words:""});S(async()=>{b()});async function b(){var d;i.value="";try{const{data:e}=await((d=r.supabaseClient)==null?void 0:d.from("musics").select());f.value=e??[]}catch(e){console.error(e),i.value=e}}async function g(d){var e;i.value="";try{const l=await((e=r.supabaseClient)==null?void 0:e.from("musics").delete().eq("id",d.id));if(l!=null&&l.error)throw l==null?void 0:l.error;b()}catch(l){console.error(l),i.value=l}}async function k(){var d;if(o.value.reference&&o.value.title&&o.value.artist&&o.value.words){i.value="";try{const e=await((d=r.supabaseClient)==null?void 0:d.from("musics").insert({...o.value,words:o.value.words.split(", ")}));if(e!=null&&e.error)throw e==null?void 0:e.error;b(),o.value={reference:"",title:"",artist:"",words:""}}catch(e){console.error(e),i.value=e}}}return(d,e)=>{var h,y;const l=L("router-link");return a(),n("div",M,[u(r).userSession?(a(),n("div",N,[t("div",null,"Logged as : "+c(u(r).userSession.user.email)+" "+c(u(r).userSession.isAdmin?"[Administrator]":""),1),t("button",{class:"btn",type:"button",onClick:e[0]||(e[0]=(...s)=>u(r).logout&&u(r).logout(...s))}," Logout ")])):(a(),n("div",j,[D,V(l,{"aria-label":"back",class:"btn",to:{name:"login"},type:"button"},{default:A(()=>[I]),_:1})])),t("table",null,[t("thead",null,[t("tr",null,[q,E,G,R,T,(h=u(r).userSession)!=null&&h.isAdmin?(a(),n("th",$)):p("",!0)])]),t("tbody",null,[(a(!0),n(U,null,B(f.value,s=>{var w;return a(),n("tr",null,[t("td",z,c(s.id),1),t("td",H,c(s.reference),1),t("td",J,c(s.title),1),t("td",K,c(s.artist),1),t("td",O,c(s.words),1),(w=u(r).userSession)!=null&&w.isAdmin?(a(),n("td",P,[t("button",{class:"btn",onClick:Z=>g(s)},"Remove",8,Q)])):p("",!0)])}),256))])]),(y=u(r).userSession)!=null&&y.isAdmin?(a(),n("form",{key:2,onSubmit:F(k,["prevent"]),class:"flex gap-2"},[_(t("input",{type:"text",placeholder:"reference","onUpdate:modelValue":e[1]||(e[1]=s=>o.value.reference=s)},null,512),[[v,o.value.reference]]),_(t("input",{type:"text",placeholder:"title","onUpdate:modelValue":e[2]||(e[2]=s=>o.value.title=s)},null,512),[[v,o.value.title]]),_(t("input",{type:"text",placeholder:"artist","onUpdate:modelValue":e[3]||(e[3]=s=>o.value.artist=s)},null,512),[[v,o.value.artist]]),_(t("input",{type:"text",placeholder:"words, words","onUpdate:modelValue":e[4]||(e[4]=s=>o.value.words=s)},null,512),[[v,o.value.words]]),W],32)):p("",!0),i.value?(a(),n("div",X,c(i.value),1)):p("",!0)])}}});export{te as default};
